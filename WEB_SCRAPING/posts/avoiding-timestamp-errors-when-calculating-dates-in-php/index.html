<!DOCTYPE html>
<html lang="en">
  <!-- Mirrored from www.abeautifulsite.net/posts/avoiding-timestamp-errors-when-calculating-dates-in-php/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Oct 2021 09:00:19 GMT -->
  <!-- Added by HTTrack --><meta
    http-equiv="content-type"
    content="text/html;charset=utf-8"
  /><!-- /Added by HTTrack -->
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avoiding timestamp errors when calculating dates in php</title>
    <meta name="description" content="A blog about everything web. Est. 2007" />
    <link rel="stylesheet" href="../../css/index.css" />
    <link
      rel="alternate"
      href="../../feed/feed.xml"
      type="application/atom+xml"
      title="A Beautiful Site"
    />
    <link
      rel="alternate"
      href="../../feed/feed.json"
      type="application/json"
      title="A Beautiful Site"
    />
    <link rel="icon" href="../../images/logos/leaf.svg" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="post-template">
    <header>
      <a href="../../index.html" class="header-link">
        <img
          src="../../images/logos/wordmark.svg"
          alt="A Beautiful Site"
          class="wordmark"
        />
      </a>

      <nav class="nav">
        <a class="nav-item" href="../../index.html"> Home </a>
        <a class="nav-item" href="../../tags/index.html"> Tags </a>
        <a class="nav-item" href="../index.html"> Archive </a>
        <a class="nav-item" href="../../about/index.html"> About </a>
        <a
          class="nav-item"
          href="#search"
          arial-label="Search"
          title="Press / to search"
          data-site-search
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
            />
          </svg>
        </a>
      </nav>
    </header>

    <main class="content">
      <hr />

      <article class="post">
        <h1>Avoiding timestamp errors when calculating dates in php</h1>

        <div class="post-date">
          <time datetime="2007-08-29"> August 29, 2007 </time>
          &bull; 3 min read
        </div>

        <div class="legacy-warning">
          <img
            src="../../images/artwork/pointer.gif"
            alt="A drawing of a cartoon man pointing upwards"
          />
          <p>
            Heads up! This post was written in 2007, so it may contain
            information that is no longer accurate. I keep posts like this
            around for historical purposes and to prevent link rot, so please
            keep this in mind as you're reading.
          </p>
          <p>â€” Cory</p>
        </div>

        <p>
          When calculating dates in PHP, it is easy to add millisecond values
          such as <code>60 * 60 * 24</code> to increment the time by one day.
          This can become problematic for two main reasons.
        </p>
        <h2 id="issues-with-leap-years">
          Issues with leap years
          <a class="direct-link" href="#issues-with-leap-years">#</a>
        </h2>
        <p>
          A year has approximately 365.25 days, hence a leap year occurs once
          every four years. If you start on Tuesday April 1, 2003 at 12:00:00
          the timestamp would be <code>1049198400</code>. Adding the length of
          one day (<code>60 * 60 * 24</code>, or 86,400ms) would give us
          <code>1049198400</code> + 86,400 = <code>1049284800</code>, which is
          the same as Wed April 02, 2003 12:00:00. No problem here.
        </p>
        <p>
          Using this same methodology, we realize that adding one year (<code
            >60 * 60 * 24 * 365</code
          >, or 31,536,000ms) to Wednesday April 02, 2003 12:00:00 would result
          in <code>1049284800</code> + 31,536,000 = <code>1080820800</code>.
          This is problematic because <code>1080820800</code> is the timestamp
          for Thursday 01 April 2004 12:00:00 (we were expecting the next day,
          02 April).
        </p>
        <p>
          Even if we used <code>60 * 60 * 24 * 365.25</code> (or 31,557,600ms)
          to compensate for the quarter-day phenomenon, we would end up with
          <code>1049284800</code> + 31,557,600 = <code>1080842400</code>, which
          is Thursday 01 Apr 2004 18:00:00. This &quot;miscalculation&quot; is
          due to the leap day that occurred on 29 February 2004.
        </p>
        <h2 id="issues-with-daylight-saving-time">
          Issues with daylight saving time
          <a class="direct-link" href="#issues-with-daylight-saving-time">#</a>
        </h2>
        <p>
          Another issue involves Daylight Saving Time (DST). The calculation is
          affected similarly and a one hour shift forward or backward will occur
          if your version of PHP is configured to account for DST. This can turn
          out to be more drastic than a one hour shift, however. Consider this:
        </p>
        <pre><code class="language-php">$current_date = &quot;2007-11-04&quot;;
$timestamp = strtotime($current_date);
$timestamp += 60 * 60 * 24; // one day increment
$new_date = date(&quot;Y-m-d&quot;, $timestamp);
</code></pre>
        <p>
          On 04 November 2007, the time &quot;falls back&quot; one hour, thus
          <code>$new_date</code> contains the same value as
          <code>$current_date</code> when <code>$current_date</code> is equal to
          <code>2007-11-04</code>. Here are some sample outputs surrounding 04
          November 2007:
        </p>
        <table>
          <thead>
            <tr>
              <th>$current_date</th>
              <th>$new_date</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>2007-11-01</td>
              <td>2007-11-02</td>
            </tr>
            <tr>
              <td>2007-11-02</td>
              <td>2007-11-03</td>
            </tr>
            <tr>
              <td>2007-11-03</td>
              <td>2007-11-04</td>
            </tr>
            <tr>
              <td>2007-11-04</td>
              <td><mark>2007-11-04</mark></td>
            </tr>
            <tr>
              <td>2007-11-05</td>
              <td>2007-11-06</td>
            </tr>
            <tr>
              <td>2007-11-06</td>
              <td>2007-11-07</td>
            </tr>
          </tbody>
        </table>
        <p>
          Consequently, if we were outputting hours, minutes and seconds as
          well, every day after the DST change would be exactly one hour off
          (until, of course, the next DST change canceled it out).
        </p>
        <h2 id="a-better-way-to-calculate-dates">
          A Better Way to Calculate Dates
          <a class="direct-link" href="#a-better-way-to-calculate-dates">#</a>
        </h2>
        <p>
          Fortunately, we can overcome both of these hurdles simply by using the
          <code>strtotime()</code> function. Instead of adding one day to a
          timestamp like this:
        </p>
        <pre><code class="language-php">$date += 60 * 60 * 24;
</code></pre>
        <p>We can successfully add one day like this:</p>
        <pre><code class="language-php">$date = strtotime(date(&quot;Y-m-d&quot;, strtotime($date)) . &quot; +1 day&quot;);
</code></pre>
        <p>
          Similarly, we can use the same method for weeks, months, years, etc.:
        </p>
        <pre><code class="language-php">$date = strtotime(date(&quot;Y-m-d&quot;, strtotime($date)) . &quot; +1 week&quot;);
$date = strtotime(date(&quot;Y-m-d&quot;, strtotime($date)) . &quot; +2 week&quot;);
$date = strtotime(date(&quot;Y-m-d&quot;, strtotime($date)) . &quot; +1 month&quot;);
$date = strtotime(date(&quot;Y-m-d&quot;, strtotime($date)) . &quot; +30 days&quot;);
</code></pre>
        <p>
          Using the <code>strtotime()</code> function to add relative blocks of
          time results in accurate calculations where the previously shown
          method sometimes fails.
        </p>
        <p>
          What if you wanted to add one month to <code>$date</code>? Using the
          previous method, you would be forced to estimate the duration of a
          month or create a really smart algorithm to figure out the exact
          duration of the given month. Since each month varies in length, the
          first option is unreliable. The second option has already been
          incorporated into the <code>strtotime()</code> function, so why not
          use that instead?
        </p>
        <h2 id="more-examples">
          More examples <a class="direct-link" href="#more-examples">#</a>
        </h2>
        <p>
          You can use the following examples to experiment with. For further
          documentation, see the <a href="http://php.net/">PHP Manual</a>'s
          section on
          <a href="http://php.net/strtotime/"><code>strtotime()</code></a
          >.
        </p>
        <pre><code class="language-php">$date = &quot;2005-05-10&quot;;
echo date(&quot;Y-m-d&quot;, strtotime(date(&quot;Y-m-d&quot;, strtotime($date)) . &quot; +30 days&quot;)); // output is 2005-06-09
echo date(&quot;Y-m-d&quot;, strtotime(date(&quot;Y-m-d&quot;, strtotime($date)) . &quot; +4 weeks&quot;)); // output is 2005-06-07
echo date(&quot;Y-m-d&quot;, strtotime(date(&quot;Y-m-d&quot;, strtotime($date)) . &quot; +1 month&quot;)); // output is 2005-06-10
</code></pre>

        <div class="tags">
          <a href="../../tags/development/index.html" class="post-tag"
            >development</a
          >
          <a href="../../tags/php/index.html" class="post-tag">php</a>
          <a href="../../tags/tips/index.html" class="post-tag">tips</a>
        </div>
      </article>

      <hr />

      <footer class="post-footer">
        <img
          src="http://0.gravatar.com/avatar/bf1b3b95fd5b096a3592247c29667b33?s=512"
          alt="Photo of Cory"
          class="avatar avatar-small"
        />

        <p>
          Written by <a href="../../index-4.html">Cory LaViska</a>, a software
          engineer and UX architect responsible for
          <a href="https://shoelace.style/">Shoelace.style</a>,
          <a href="https://www.surrealcms.com/">Surreal&nbsp;CMS</a>, and other
          <a href="https://github.com/claviska">open source things</a>.
        </p>

        <p>
          You can follow Cory on
          <a href="https://twitter.com/claviska">Twitter</a> and
          <a href="https://github.com/claviska">GitHub</a>.
        </p>
      </footer>

      <hr />

      <nav class="post-nav">
        <a
          href="../an-excellent-free-font-resource/index.html"
          class="post-nav-previous"
        >
          <small>Previous post</small>
          DaFont: an excellent free font resource
        </a>

        <a
          href="../javascript-functions-for-basename-and-dirname/index.html"
          class="post-nav-next"
        >
          <small>Up next</small>
          JavaScript functions for basename and dirname
        </a>
      </nav>
    </main>

    <div class="site-search" hidden>
      <div class="site-search-panel">
        <header class="site-search-header">
          <input type="text" placeholder="Search" class="site-search-input" />
        </header>
        <div class="site-search-body">
          <ul class="site-search-results"></ul>
        </div>
      </div>
    </div>

    <script src="../../../cdn.jsdelivr.net/npm/lunr%402.3.9/lunr.min.js"></script>
    <script src="../../js/search.js"></script>

    <script defer src="../../js/greeting.js"></script>
    <script
      defer
      src="../../../cdn.jsdelivr.net/gh/PrismJS/prism%401.23.0/prism.js"
    ></script>
    <script
      defer
      src="../../../cdn.jsdelivr.net/npm/prismjs%401.23.0/components/prism-bash.js"
    ></script>
    <script
      defer
      src="../../../cdn.jsdelivr.net/npm/prismjs%401.23.0/components/prism-markup-templating.js"
    ></script>
    <script
      defer
      src="../../../cdn.jsdelivr.net/npm/prismjs%401.23.0/components/prism-php.js"
    ></script>
    <script
      defer
      src="../../../cdn.jsdelivr.net/npm/prismjs%401.23.0/components/prism-typescript.js"
    ></script>

    <!-- Current page: /posts/avoiding-timestamp-errors-when-calculating-dates-in-php/ -->
  </body>

  <!-- Mirrored from www.abeautifulsite.net/posts/avoiding-timestamp-errors-when-calculating-dates-in-php/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Oct 2021 09:00:19 GMT -->
</html>
