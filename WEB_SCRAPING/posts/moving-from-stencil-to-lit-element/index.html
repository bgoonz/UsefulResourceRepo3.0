<!doctype html>
<html lang="en">
  
<!-- Mirrored from www.abeautifulsite.net/posts/moving-from-stencil-to-lit-element/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Oct 2021 08:59:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moving from Stencil to LitElement</title>
    <meta name="description" content="A blog about everything web. Est. 2007">
    <link rel="stylesheet" href="../../css/index.css">
    <link rel="alternate" href="../../feed/feed.xml" type="application/atom+xml" title="A Beautiful Site">
    <link rel="alternate" href="../../feed/feed.json" type="application/json" title="A Beautiful Site">
    <link rel="icon" href="../../images/logos/leaf.svg" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.gstatic.com/">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet">
  </head>
  <body class="post-template">
    <header>
      <a href="../../index.html" class="header-link">
        <img src="../../images/logos/wordmark.svg" alt="A Beautiful Site" class="wordmark">
      </a>

      <nav class="nav">
          <a class="nav-item" href="../../index.html">
            Home
          </a>
          <a class="nav-item" href="../../tags/index.html">
            Tags
          </a>
          <a class="nav-item" href="../index.html">
            Archive
          </a>
          <a class="nav-item" href="../../about/index.html">
            About
          </a>
        <a class="nav-item" href="#search" arial-label="Search" title="Press / to search" data-site-search>
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
          </svg>
        </a>
      </nav>
    </header>

    <main class="content">
      
<hr>

<article class="post">
  <h1>Moving from Stencil to LitElement</h1>

  <div class="post-date">
    <time datetime="2021-03-02">
      March 02, 2021
    </time>
    &bull;
    7 min read
  </div>

  

  <p>Over the weekend, I finished migrating <a href="https://shoelace.style/">Shoelace</a> from <a href="https://stenciljs.com/">Stencil</a> to <a href="#">LitElement</a>. Even though consumers of the library won't see much of a difference, this was a major overhaul of Shoelace's internals.</p>
<p>Naturally, such a big change brings questions from the community, such as <a href="https://twitter.com/bitflowertweets/status/1365644475087941635?s=20">&quot;what were the reasons behind shifting away from Stencil?&quot;</a> These are valid questions, so I wanted to take the time to answer them here.</p>
<p>But before I jump in, it's worth mentioning that Stencil is a great project that played a significant role in getting me into web components. Being able to type <code>npm init stencil</code> and have an entire project ready to go is really something special.</p>
<p>Let it also be clear that this isn't a jab at Stencil, nor is it advice for or against using Stencil to build your own projects. This is why <em>I</em> chose to move on based on <em>my</em> experience, <em>my</em> observations, and <em>my</em> desire to own as much of my own code as possible.</p>
<h2 id="less-is-more">Less is more <a class="direct-link" href="#less-is-more">#</a></h2>
<p>When you're managing a software project, dependencies can quickly become liabilities. Despite its many niceties, Stencil can be a box of mystery at times. As a contributor, it was difficult for me to dive into its codebase and figure things out. There's little documentation on its internals, so everything requires digging. A lot of digging. Even as a member of the Stencil team, I found it hard to get the information I needed to make useful contributions to the project.</p>
<p>Why does this matter? Well, when code is complex and lacks documentation, the barrier of entry is higher and people are less apt to make contributions. Despite a tight-knit community of talented Stencil users, many bugs continue to go unpatched. Even worse, a bot <a href="https://github.com/ionic-team/stencil/issues?q=is%3Aissue+label%3A%22ionitron%3A+stale+issue%22+">closes issues</a> after 30 days of inactivity, so many of the bugs that do get reported are <a href="https://github.com/ionic-team/stencil/issues/2802">closed without feedback or resolution</a>. In my opinion, valid, reproducible bugs should remain open until they're resolved to provide transparency and accountability.</p>
<p>One might surmise that the maintainers are overwhelmed by the number of bugs that get filed, but garbage collecting valid issues is disingenuous and a disservice to the community. I appreciate that Stencil is open source and its maintainers have zero responsibility to fix bugs for free, but I fundamentally disagree with this aspect of how the project is maintained.</p>
<p>And what happens when I have an issue that I can't resolve myself? Will someone point me in the right direction? Will it ever get fixed? <a href="https://github.com/ionic-team/stencil/issues/2198">Probably not.</a> (That was submitted a year ago, before issues were automatically closed.)</p>
<h2 id="build-%26-distribution">Build &amp; distribution <a class="direct-link" href="#build-%26-distribution">#</a></h2>
<p>Stencil is a compiler that generates components using any number of possible <a href="https://stenciljs.com/docs/output-targets">output targets</a>. In theory, this is really convenient because it can produce multiple distributions from a single source. In practice, I found that having two separate distributions made my project harder to document and left users confused.</p>
<p>These output targets are also limited in terms of configuration. Since last year, Shoelace was plagued with a <a href="https://github.com/shoelace-style/shoelace/issues/180">tree shaking problem</a> I couldn't fix because of this. Moving away from Stencil, I was able to gain full control over how my build works and the tooling used to power it. I leaned on standards and went with a single collection of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">ES modules</a> that work in both browsers and bundlers. Best of all, having full control over the build let me finally resolve that pesky tree shaking issue.</p>
<h2 id="less-magic">Less Magic <a class="direct-link" href="#less-magic">#</a></h2>
<p>Speaking of distributions, one thing I'm losing by leaving Stencil is its <a href="https://stenciljs.com/docs/distribution">lazy loading dist</a>. At first, I wondered how I could reproduce this outside of Stencil. It's a very convenient feature for users.</p>
<p>Lazy loading works by registering every component as an empty custom element. Then, when you insert a component into the DOM, its source is fetched and its internals are swapped out. This is necessary because <a href="https://github.com/WICG/webcomponents/issues/829">you can't reregister custom elements</a>, so you have to resort to a bit of magic. It's a clever trick, but it does lead to a form of <a href="https://en.wikipedia.org/wiki/Flash_of_unstyled_content">FOUC</a>, especially when components are added after the initial page load.</p>
<p>I believe it was also the source of some strange Shoelace + React/Svelte timing bugs and a very annoying error I kept seeing on the documentation website:</p>
<blockquote>
<p>Uncaught (in promise) DOMException: Failed to set the 'adoptedStyleSheets' property on 'ShadowRoot': Sharing constructed stylesheets in multiple documents is not allowed</p>
</blockquote>
<p>I'm pretty sure this was a combination of how Docsify loads pages and Stencil's lazy loading, but I was never able to pinpoint it. Regardless, it's no longer an issue with the new version.</p>
<p>Considering all this, I thought long and hard about the benefits and drawbacks of lazy loading. Ultimately, I decided it wasn't worth the effort. With the latest version of Shoelace, users can load the <a href="https://shoelace.style/getting-started/installation">entire library</a> or <a href="https://shoelace.style/getting-started/installation?id=cherry-picking">cherry pick</a> components — something that wasn't possible before. I think that's a fair tradeoff to avoid all the weird issues it seemed to be causing.</p>
<h2 id="native-templates">Native templates <a class="direct-link" href="#native-templates">#</a></h2>
<p>I prefer to stick to the platform when possible. Although I like JSX, I like <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">template literals</a> even better because they're simple and they don't require transpilation. Now that the platform has a built-in for templating, we should utilize it.</p>
<p>The syntax is similar, but not identical. Here's the original render function from Shoelace's badge component.</p>
<pre><code class="language-js">// JSX
render() {
  return (
    &lt;span
      part=&quot;base&quot;
      class={({
        badge: true,
        'badge--primary': this.type === 'primary',
        'badge--success': this.type === 'success',
        'badge--info': this.type === 'info',
        'badge--warning': this.type === 'warning',
        'badge--danger': this.type === 'danger',
        'badge--pill': this.pill,
        'badge--pulse': this.pulse
      })}
      role=&quot;status&quot;
    &gt;
      &lt;slot /&gt;
    &lt;/span&gt;
  );
}
</code></pre>
<p>Compare that to the native equivalent.</p>
<pre><code class="language-js">// Template literals
render() {
  return html`
    &lt;span
      part=&quot;base&quot;
      class=${classMap({
        badge: true,
        'badge--primary': this.type === 'primary',
        'badge--success': this.type === 'success',
        'badge--info': this.type === 'info',
        'badge--warning': this.type === 'warning',
        'badge--danger': this.type === 'danger',
        'badge--pill': this.pill,
        'badge--pulse': this.pulse
      })}
      role=&quot;status&quot;
    &gt;
      &lt;slot /&gt;
    &lt;/span&gt;
  `;
}
</code></pre>
<p>They're so similar. I just don't see why I should run the code through another layer of transpilation when template literals suffice. This is what they were designed to do.</p>
<p>A special syntax is no longer necessary.</p>
<h2 id="virtual-dom">Virtual DOM <a class="direct-link" href="#virtual-dom">#</a></h2>
<p>Like React and other popular frameworks, Stencil uses a virtual DOM (&quot;VDOM&quot;) to render things faster than working directly with the real DOM. However, it's a common misconception that VDOMs are actually faster. <a href="https://svelte.dev/blog/virtual-dom-is-pure-overhead">Rich Harris writes:</a></p>
<blockquote>
<p>But hang on a minute! The virtual DOM operations are <strong>in addition to</strong> the eventual operations on the real DOM. The only way it could be faster is if we were comparing it to a less efficient framework (there were plenty to go around back in 2013!), or arguing against a straw man — that the alternative is to do something no-one actually does.</p>
</blockquote>
<p>It's an outdated meme. You can write poor performing components with or without a virtual DOM. Consider <a href="https://lit-html.polymer-project.org/">lit-html</a> and <a href="https://github.com/WebReflection/uhtml">µhtml</a>, both of which leverage direct DOM diffing for fast, efficient rendering.</p>
<p>There's no need for an extra layer here, either.</p>
<h2 id="a-long-time-coming">A long time coming <a class="direct-link" href="#a-long-time-coming">#</a></h2>
<p>The move away from Stencil was inevitable. As part of my never-ending quest for simplicity, I've been experimenting with other libraries for a long time. One of the first I explored was <a href="https://hybrids.js.org/#/">Hybrids</a>, which is great if you want to go with a more functional approach. Ultimately, I decided that class-based made the most sense because, well, that's how you create custom elements. You can't do it without extending <code>HTMLElement</code>.</p>
<pre><code class="language-js">class SlButton extends HTMLElement {
  // build something awesome
}
</code></pre>
<p>I also dove into <a href="https://www.fast.design/">Microsoft FAST</a> and I like what they're doing. The API is very sensible, but its templates feel a bit strange since you have to use <code>attr=${x =&gt; x.prop}</code> instead of <code>attr=${this.prop}</code>. I believe they do this to provide a faster alternative to DOM-diffing during render, but this would mean a lot more work for me. I also found it confusing that contexts can be nested, which makes larger templates harder to maintain.</p>
<p>I experimented with my own base class called <a href="https://github.com/shoelace-style/shoemaker">Shoemaker</a>. I wanted to make the thinnest possible abstraction around the features I needed, but the more the project evolved the more I realized I was recreating <a href="https://lit-element.polymer-project.org/">LitElement</a>. Between that and feedback from the community, I decided it didn't make sense to reinvent the wheel.</p>
<p>I do have a few [opinionated] DX concerns that I'll be sending over to the LitElement team for consideration. However, I've alleviated most of them with a handful of custom decorators.</p>
<p>I guess that's the nice thing about decorators — you can customize them to your liking.</p>
<h2 id="moving-forward">Moving forward <a class="direct-link" href="#moving-forward">#</a></h2>
<p>Consumers of Shoelace won't notice much of a difference in this release. I've simply replaced the old engine with a new one that does the same thing except with a leaner, simpler codebase with less magic. I have a responsibility to my users, so I need to be able to fix problems when they arise. I wasn't always able to do that before. Now I can.</p>
<p>I'm tired of rebuilding buttons. I designed Shoelace for longevity, taking advantage of the best parts of the platform — the stuff that doesn't change on us every few years. It only makes sense to bring its code closer to the platform as well.</p>
<p>With LitElement, I'm getting all the features I want with the smallest possible footprint. Now I can get back to building components again.</p>
<p><em>March 8, 2021 - updated to reflect the latest changes to the library.</em></p>


  <div class="tags">
    
  <a href="../../tags/news/index.html" class="post-tag">news</a>
  <a href="../../tags/shoelace/index.html" class="post-tag">shoelace</a>
  <a href="../../tags/design/index.html" class="post-tag">design</a>
  <a href="../../tags/development/index.html" class="post-tag">development</a>
  <a href="../../tags/web%20components/index.html" class="post-tag">web components</a>

  </div>
</article>

<hr>

<footer class="post-footer">
  <img src="http://0.gravatar.com/avatar/bf1b3b95fd5b096a3592247c29667b33?s=512" alt="Photo of Cory" class="avatar avatar-small">

  <p>
    Written by <a href="../../index-4.html">Cory LaViska</a>, a software engineer and UX architect responsible for
    <a href="https://shoelace.style/">Shoelace.style</a>, <a href="https://www.surrealcms.com/">Surreal&nbsp;CMS</a>, and
    other <a href="https://github.com/claviska">open source things</a>.
  </p>

  <p>
    You can follow Cory on <a href="https://twitter.com/claviska">Twitter</a> and <a href="https://github.com/claviska">GitHub</a>.
  </p>
</footer>

<hr>

<nav class="post-nav">
    <a href="../svg-repo/index.html" class="post-nav-previous">
      <small>Previous post</small>
      SVG Repo
    </a>
  
    <a href="../finding-the-active-element-in-a-shadow-root/index.html" class="post-nav-next">
      <small>Up next</small>
      Finding the active element in a shadow root
    </a>
  
</nav>

    </main>

    <div class="site-search" hidden>
      <div class="site-search-panel">
        <header class="site-search-header">
          <input type="text" placeholder="Search" class="site-search-input">
        </header>
        <div class="site-search-body">
          <ul class="site-search-results"></ul>
        </div>
      </div>
    </div>

    <script src="../../../cdn.jsdelivr.net/npm/lunr%402.3.9/lunr.min.js"></script>
    <script src="../../js/search.js"></script>

    <script defer src="../../js/greeting.js"></script>
    <script defer src="../../../cdn.jsdelivr.net/gh/PrismJS/prism%401.23.0/prism.js"></script>
    <script defer src="../../../cdn.jsdelivr.net/npm/prismjs%401.23.0/components/prism-bash.js"></script>
    <script defer src="../../../cdn.jsdelivr.net/npm/prismjs%401.23.0/components/prism-markup-templating.js"></script>
    <script defer src="../../../cdn.jsdelivr.net/npm/prismjs%401.23.0/components/prism-php.js"></script>
    <script defer src="../../../cdn.jsdelivr.net/npm/prismjs%401.23.0/components/prism-typescript.js"></script>

    <!-- Current page: /posts/moving-from-stencil-to-lit-element/ -->
  </body>

<!-- Mirrored from www.abeautifulsite.net/posts/moving-from-stencil-to-lit-element/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Oct 2021 08:59:02 GMT -->
</html>
